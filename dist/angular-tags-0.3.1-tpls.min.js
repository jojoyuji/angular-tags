!function(){"use strict";var a=function(a,b){return Array.isArray(b)?(b.forEach(function(a){a=a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}),a.split(new RegExp(b.join("|"),"g"))):a.split(b)};try{angular.module("decipher.tags.templates")}catch(b){angular.module("decipher.tags.templates",[])}var c=angular.module("decipher.tags",["ui.bootstrap.typeahead","decipher.tags.templates"]),d={delimiter:",",classes:{}},e=/^\s*(.*?)(?:\s+as\s+(.*?))?\s+for\s+(?:([\$\w][\$\w\d]*))\s+in\s+(.*)$/,f={enter:13,esc:27,backspace:8},g=[f.enter],h=[f.backspace],i=[f.esc],j=0;c.constant("decipherTagsOptions",{}),c.controller("TagsCtrl",["$scope","$timeout","$q",function(a,b,c){a.getClasses=function(b){var c={};return b===a.toggles.selectedTag&&(c.selected=!0),angular.forEach(a.options.classes,function(a,d){b.group===d&&(c[a]=!0)}),c},a._filterSrcTags=function(d){return b(function(){var b=a.srcTags.indexOf(d);return b>=0?(a.srcTags.splice(b,1),void a._deletedSrcTags.push(d)):c.reject()})},a.add=function(b){var d,e=function(b){a.tags.push(b),delete a.inputTag,a.$emit("decipher.tags.added",{tag:b,$id:a.$id})},f=function(){a.$emit("decipher.tags.addfailed",{tag:b,$id:a.$id}),g.reject()},g=c.defer();for(d=a.tags.length;d--;)a.tags[d].name===b.name&&f();return a._filterSrcTags(b).then(function(){e(b)},function(){a.options.addable?(e(b),g.resolve()):f()}),g.promise},a.trust=function(a){return $sce.trustAsHtml(a.name)},a.selectArea=function(){a.toggles.inputActive=!0},a.remove=function(b){var c;a.tags.splice(a.tags.indexOf(b),1),(c=a._deletedSrcTags.indexOf(b)>=0)&&(a._deletedSrcTags.splice(c,1),-1===a.srcTags.indexOf(b)&&a.srcTags.push(b)),delete a.toggles.selectedTag,a.$emit("decipher.tags.removed",{tag:b,$id:a.$id})}}]),c.directive("decipherTagsInput",["$timeout","$filter","$rootScope",function(b,c,d){return{restrict:"C",require:"ngModel",link:function(e,f,j,k){var l;angular.isArray(e.options.delimiter)?(l=[],angular.forEach(e.options.delimiter,function(a){l.push(new RegExp("^"+a+"+$"))})):l=new RegExp("^"+e.options.delimiter+"+$");var m=function(){k.$setViewValue(""),k.$render()},n=function(a){if(a){if(angular.isArray(l))angular.forEach(l,function(b){return a.match(b)?void m():void 0});else if(a.match(l))return void m();e.add({name:a})&&m()}},o=function(a){var b;for(b=0;b<a.length;b++)n(a[b])},p=function(){var a;e.toggles.selectedTag?(e.remove(e.toggles.selectedTag),delete e.toggles.selectedTag):k.$viewValue||(a=c("orderBy")(e.tags,e.orderBy),e.toggles.selectedTag=a[a.length-1])};f.bind("focus",function(){d.$$phase?delete e.toggles.selectedTag:e.$apply(function(){delete e.toggles.selectedTag})}),f.bind("blur",function(){n(k.$viewValue)}),f.bind("keypress",function(a){e.$apply(function(){angular.isArray(e.options.delimiter)?angular.forEach(e.options.delimiter,function(b){b.charCodeAt()===a.which&&(a.preventDefault(),n(k.$viewValue))}):e.options.delimiter.charCodeAt()===a.which&&n(k.$viewValue)})}),f.bind("keydown",function(a){e.$apply(function(){g.indexOf(a.which)>=0?n(k.$viewValue):i.indexOf(a.which)>=0&&!a.isPropagationStopped()?(m(),e.toggles.inputActive=!1):h.indexOf(a.which)>=0?p():(delete e.toggles.selectedTag,e.$emit("decipher.tags.keyup",{value:k.$viewValue,$id:e.$id}))})}),e.$watch("toggles.inputActive",function(a){a&&b(function(){f[0].focus()})}),k.$parsers.unshift(function(b){var c;return c=a(b,e.options.delimiter),c.length>1&&o(c),b.match(l)?void f.val(""):b}),k.$formatters.push(function(a){return a&&a.value?void f.val(""):a})}}}]),c.directive("tags",["$document","$timeout","$parse","decipherTagsOptions",function(b,c,f,g){return{controller:"TagsCtrl",restrict:"E",replace:!0,template:"<div><div data-ng-include=\"'templates/tags.html'\"></div></div>",scope:{model:"="},link:function(b,c,h){var i,k,l,m,n,o,p,q,r=!1,s=!1,t=angular.copy(d),u=angular.copy(g),v=function(a){var b=a.match(e);if(!b)throw new Error("Expected src specification in form of '_modelValue_ (as _label_)? for _item_ in _collection_' but got '"+a+"'.");return{itemName:b[3],source:f(b[4]),sourceName:b[4],viewMapper:f(b[2]||b[1]),modelMapper:f(b[1])}},w=function(){p=b.$watch("model",function(a){var c,d;if(angular.isDefined(a)){for(n(),b.tags=y(a),m=b.tags.length;m--;)b._filterSrcTags(b.tags[m]);for(m=b._deletedSrcTags.length;m--;)c=b._deletedSrcTags[m],(d=-1===a.indexOf(c)&&-1===b.srcTags.indexOf(c))&&(b.srcTags.push(c),b._deletedSrcTags.splice(m,1));x()}},!0)},x=function(){n=b.$watch("tags",function(a,c){var d;if(a!==c){if(p(),s||r){if(a=a.map(function(a){return a.name}),angular.isArray(b.model))for(b.model.length=0,d=0;d<a.length;d++)b.model.push(a[d]);r&&(b.model=a.join(b.options.delimiter))}else for(b.model=[],d=0;d<a.length;d++)b.model.push(a[d]);w()}},!0)},y=function(c){var d=[];if(!angular.isUndefined(c)){if(angular.isString(c))angular.isArray(b.options.delimiter)||(d=a(c,b.options.delimiter),d=d.map(function(a){return{name:a.trim()}}));else if(angular.isArray(c))d=c.map(function(a){return angular.isString(a)?{name:a.trim()}:(a.name&&(a.name=a.name.trim()),a)});else if(angular.isDefined(c))throw"list of tags must be an array or delimited string";return d}},z=function A(){var a,c,d,e;if(b.options.addable=b.options.addable||!1,b.srcTags=[],i=v(h.src),k=i.source(b.$parent),!angular.isUndefined(k)){if(angular.isFunction(o)&&o(),a={},angular.isDefined(k))for(c=0;c<k.length;c++)a[i.itemName]=k[c],e={},e.value=i.modelMapper(b.$parent,a),d={},d=angular.isObject(e.value)?angular.extend(e.value,{name:i.viewMapper(b.$parent,a),value:e.value.value,group:e.value.group}):{name:i.viewMapper(b.$parent,a),value:e.value,group:l},b.srcTags.push(d);o=b.$parent.$watch(i.sourceName,function(a,b){a!==b&&A()},!0)}};b.options=angular.extend(t,angular.extend(u,b.$eval(h.options))),b.orderBy=b.options.orderBy,b.toggles={inputActive:!1},b.$on("decipher.tags.sort",function(a,c){b.orderBy=c}),h.$observe("typeaheadOptions",function(a){b.typeaheadOptions=a?f(a)(b.$parent):{}}),q=b.model,angular.isString(q)&&(r=!0),b.tags=[],b._deletedSrcTags=[],x(),w(),b.srcTags=[],angular.isDefined(h.src)?z():b.options.addable=!0,b.$id=++j,b.$emit("decipher.tags.initialized",{$id:b.$id,model:b.model})}}}])}(),angular.module("decipher.tags.templates",["templates/tags.html"]),angular.module("templates/tags.html",[]).run(["$templateCache",function(a){a.put("templates/tags.html",'<div class="decipher-tags" data-ng-mousedown="selectArea()">\n\n  <div class="decipher-tags-taglist">\n    <span data-ng-repeat="tag in tags|orderBy:orderBy"\n          data-ng-mousedown="$event.stopPropagation()">\n<span class="decipher-tags-tag" data-ng-class="getClasses(tag)">{{tag.name}}\n      <i class="icon-remove" data-ng-click="remove(tag)"></i>\n</span>\n    </span>\n  </div>\n\n  <span class="container-fluid" data-ng-show="toggles.inputActive">\n    <input ng-if="!srcTags.length" type="text" data-ng-model="inputTag"\n           class="decipher-tags-input"/>\n    <!-- may want to fiddle with limitTo here, but it was inhibiting my results\n    so perhaps there is another way -->\n    <input ng-if="srcTags.length" type="text" data-ng-model="inputTag"\n           class="decipher-tags-input"\n           data-typeahead="stag as stag.name for stag in srcTags|filter:$viewValue|orderBy:orderBy"\n           data-typeahead-input-formatter="{{typeaheadOptions.inputFormatter}}"\n           data-typeahead-loading="{{typeaheadOptions.loading}}"\n           data-typeahead-min-length="{{typeaheadOptions.minLength}}"\n           data-typeahead-template-url="{{typeaheadOptions.templateUrl}}"\n           data-typeahead-wait-ms="{{typeaheadOptions.waitMs}}"\n\n           data-typeahead-editable="{{typeaheadOptions.allowsEditable}}"\n           data-typeahead-on-select="add($item) && selectArea() && typeaheadOptions.onSelect()"/>\n\n  </span>\n</div>\n')}]);
//# sourceMappingURL=angular-tags-0.3.1-tpls.map.js